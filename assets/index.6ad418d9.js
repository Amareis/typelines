import{v as W,t as P,G as j,d as F,c as $,a as M,o as Y,b as A,i as w,e as _,f as B,F as G,g as X,r as I}from"./vendor.9dc1279d.js";const J=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&p(u)}).observe(document,{childList:!0,subtree:!0});function r(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerpolicy&&(d.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?d.credentials="include":o.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function p(o){if(o.ep)return;o.ep=!0;const d=r(o);fetch(o.href,d)}};J();function T(i={}){const{immediate:t=!1,onNeedRefresh:r,onOfflineReady:p,onRegistered:o,onRegisterError:d}=i;let u;const y=async(f=!0)=>{};return"serviceWorker"in navigator&&(u=new W("/typelines/sw.js",{scope:"/typelines/"}),u.addEventListener("activated",f=>{f.isUpdate?window.location.reload():p==null||p()}),u.register({immediate:t}).then(f=>{o==null||o(f)}).catch(f=>{d==null||d(f)})),y}const C=[[240,163,255],[0,117,220],[153,63,0],[76,0,92],[25,25,25],[0,92,49],[43,206,72],[255,204,153],[128,128,128],[143,124,0],[157,204,0],[194,0,136],[0,51,128],[255,164,5],[255,168,187],[66,102,0],[255,0,16],[0,153,143],[116,10,255],[153,0,0],[255,80,5]],L=P("<div></div>"),q=P('<textarea autocorrect="off" autocapitalize="none"></textarea>'),z=P("<div>&nbsp;</div>"),H=new j;function O(i,t){return(()=>{const r=L.cloneNode(!0);return r.style.setProperty("position","absolute"),r.style.setProperty("white-space","pre"),r.style.setProperty("color",t),w(r,i),r})()}const E=320,S=320;function K(i){let t=0;for(let r=0;r<i.length;r++)t=(t<<5)-t+i.charCodeAt(r)|0;return t}const U=()=>{let i,t,[r,p]=$(20),[o,d]=$(S/2-10),[u,y]=$(r()),[f,b]=$(o()),h;const m=M({});Y(()=>{t.value=" ",t.focus(),h=new WebSocket("wss://worker.terma95.workers.dev/api/ws"),h.addEventListener("message",e=>{const{message:c,id:s}=JSON.parse(e.data);c?c.l?R(s,c.l,c.x,c.y):x(s,c.x,c.y):delete m[s]})});function x(e,c,s){let n=m[e];if(n)return n.x=c,n.y=s,n;const l=`rgb(${C[K(e)%C.length].join(",")})`;return m[e]={x:c,y:s,color:l}}function g(e){h.send(JSON.stringify({message:{l:e,x:u(),y:f()}}))}A(()=>{h.close(),console.log("clear!")});function R(e,c,s,n){const l=x(e,s,n),a=O(c,l.color);i.appendChild(a),a.style.bottom=n+"px",a.style.left=s-a.clientWidth+"px",X({targets:a,duration:3e3,translateY:-20}).finished.then(()=>i.removeChild(a))}function N(){b(Math.max(f()-15,0))}return[(()=>{const e=L.cloneNode(!0),c=i;return typeof c=="function"?c(e):i=e,e.style.setProperty("position","relative"),e.style.setProperty("overflow","hidden"),e.style.setProperty("width","320px"),e.style.setProperty("height","320px"),e.style.setProperty("background","white"),w(e,_(G,{get each(){return Object.values(m)},children:s=>(()=>{const n=z.cloneNode(!0);return n.style.setProperty("position","absolute"),B(l=>{const a=s.y+"px",v=s.x+"px",k=s.color;return a!==l._v$&&n.style.setProperty("bottom",l._v$=a),v!==l._v$2&&n.style.setProperty("left",l._v$2=v),k!==l._v$3&&n.style.setProperty("background",l._v$3=k),l},{_v$:void 0,_v$2:void 0,_v$3:void 0}),n})()})),e})(),(()=>{const e=q.cloneNode(!0);e.$$input=s=>{const n=s.currentTarget.value;if(s.currentTarget.value=" ",!n){u()===r()?b(o()):y(r()),g("");return}if(n.includes(`
`)){y(r()),N(),g("");return}H.splitGraphemes(n.slice(1)).forEach(l=>{const a=O(l);i.appendChild(a);const v=u()+a.clientWidth;v+10<E?y(v):(y(r()),N()),i.removeChild(a),g(l)})},e.$$click=s=>{const n=i.getBoundingClientRect(),l=n.bottom-s.clientY,a=s.clientX-n.left;l<0||l>S-35||a<0||a>E-10||(d(l),p(a),y(a),b(l),g(""))};const c=t;return typeof c=="function"?c(e):t=e,e.style.setProperty("opacity","0"),e.style.setProperty("position","absolute"),e.style.setProperty("top","-100px"),e.style.setProperty("left","0"),e.style.setProperty("width","100%"),e.style.setProperty("height","300%"),e})()]};F(["click","input"]);const D=P('<div><div id="log"></div></div>'),Q=()=>{let i;return(()=>{const t=D.cloneNode(!0);t.firstChild;const r=i;return typeof r=="function"?r(t):i=t,t.style.setProperty("background","gray"),t.style.setProperty("display","flex"),t.style.setProperty("justify-content","center"),t.style.setProperty("height","100%"),t.style.setProperty("position","relative"),t.style.setProperty("overflow","hidden"),w(t,_(U,{}),null),t})()};I(()=>_(Q,{}),document.getElementById("root"));T({onNeedRefresh:()=>location.reload()});
